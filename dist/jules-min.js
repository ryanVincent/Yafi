"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Action=function t(e){_classCallCheck(this,t),this.origin="unknown",this.type="default",this.payload=e,this.error=!1},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Dispatcher=function(){function t(){_classCallCheck(this,t),this.callbacks={},this._isDispatching=!1,this._action={}}return _createClass(t,[{key:"dispatch",value:function(t){if(this._isDispatching)throw"Cannot call Dispatcher.dispatch while it is currently dispatching.";this._startDispatch(t);for(var e in this.callbacks)this.callbacks.hasOwnProperty(e)&&this._invokeCallback(e);this._isDispatching=!1}},{key:"isDispatching",value:function(){return this._isDispatching}},{key:"register",value:function(t){var e=utils.guid(),i={callback:t,isPending:!1,isProcessed:!1};return this.callbacks[e]=i,e}},{key:"unregister",value:function(t){delete this.callbacks[t]}},{key:"waitFor",value:function(t){for(var e=0;e<t.length;e++){var i=t[e],n=this.callbacks[i];if(n.isPending)throw"Circular reference detected: does your token list include the callback it is called from?";n.isHandled||this._invokeCallback(i)}}},{key:"_invokeCallback",value:function(t){var e=this.callbacks[t];e.isPending=!0,e.callback(this._action),e.isHandled=!0}},{key:"_startDispatch",value:function(t){this._action=t;for(var e in this.callbacks)if(this.callbacks.hasOwnProperty(e)){var i=this.callbacks[e];i.isPending=!1,i.isHandled=!1}this._isDispatching=!0}},{key:"_finishDispatch",value:function(){delete this._action,this._isDispatching=!1}}]),t}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Emitter=function(){function t(){_classCallCheck(this,t),this._listeners={}}return _createClass(t,[{key:"emit",value:function(t){for(var e in this._listeners[t])this._listeners[t][e]()}},{key:"on",value:function(t,e){this._listeners.hasOwnProperty(t)||(this._listeners[t]={});var i=utils.guid();return this._listeners[t][i]=e,i}},{key:"off",value:function(t,e){this._listeners[t][e]}}]),t}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Store=function(){function t(e,i){_classCallCheck(this,t),this._dispatcher=e,this._emitter=i||new Emitter,this._listeners={};var n=this;this._dispatcherToken=this._dispatcher.register(function(t){n._onDispatch(t)}),this._state={}}return _createClass(t,[{key:"_onDispatch",value:function(t){for(var e in this._listeners)this._listeners[e].call(this,t)}},{key:"setInitialState",value:function(t){this._state=t,this.emit("change")}},{key:"getState",value:function(){return this._state}},{key:"setState",value:function(t){utils.merge(this._state,t)}},{key:"emit",value:function(t){this._emitter.emit(t)}},{key:"on",value:function(t,e){this._emitter.on(t,e)}},{key:"off",value:function(t,e){this._emitter.off(t,e)}},{key:"addDispatchListener",value:function(t){var e=utils.guid();this._listeners[e]=t}},{key:"removeDispatchListener",value:function(t){delete this._listeners[t]}},{key:"getDispatcherToken",value:function(){return this._dispatcherToken}}]),t}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),WebAPI=function(){function t(e,i){_classCallCheck(this,t),this._root=e,this._dispatcher=i,this.services={},this._listeners={};var n=this;this._dispatcherToken=this._dispatcher.register(function(t){n._onDispatch(t)})}return _createClass(t,[{key:"_onDispatch",value:function(t){for(var e in this._listeners)this._listeners[e].call(this,t)}},{key:"addService",value:function(t,e){this.services[t]=e}},{key:"addDispatchListener",value:function(t){var e=utils.guid();this._listeners[e]=t}},{key:"removeDispatchListener",value:function(t){delete this._listeners[t]}}]),t}(),utils=function(){var t=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e=function i(t,e){"object"!=typeof t&&(t={});for(var n in e)if(e.hasOwnProperty(n)){var s=e[n];if("object"==typeof s){t[n]=i(t[n],s);continue}t[n]=s}for(var a=2,r=arguments.length;r>a;a++)i(t,arguments[a]);return t};return{guid:t,merge:e}}();